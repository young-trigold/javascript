**目录：**

- [17. 事件](#17-事件)
    - [17.0.1. 事件流](#1701-事件流)
    - [17.0.2. 事件冒泡](#1702-事件冒泡)
    - [17.0.3. 事件捕获](#1703-事件捕获)

# 17. 事件

本章内容
- 理解事件流
- 使用事件处理程序
- 了解不同类型的事件

JavaScript 与HTML 的交互是通过事件实现的，事件代表文档或浏览器窗口中某个有意义的时刻。可以使用仅在事件发生时执行的监听器（也叫处理程序）订阅事件。在传统软件工程领域，这个模型叫“观察者模式”，其能够做到页面行为（在JavaScript 中定义）与页面展示（在HTML 和CSS 中定义）的分离。

事件最早是在IE3 和Netscape Navigator 2 中出现的，当时的用意是把某些表单处理工作从服务器转移到浏览器上来。到了IE4 和Netscape Navigator 3 发布的时候，这两家浏览器都提供了类似但又不同的API，而且持续了好几代。DOM2 开始尝试以符合逻辑的方式来标准化DOM 事件API。目前所有现代浏览器都实现了DOM2 Events 的核心部分。IE8 是最后一个使用专有事件系统的主流浏览器。

浏览器的事件系统非常复杂。即使所有主流浏览器都实现了DOM2 Events，规范也没有涵盖所有的事件类型。BOM 也支持事件，这些事件与DOM 事件之间的关系由于长期以来缺乏文档，经常容易被混淆（HTML5 已经致力于明确这些关系）。而DOM3 新增的事件API 又让这些问题进一步复杂化了。根据具体的需求不同，使用事件可能会相对简单，也可能会非常复杂。但无论如何，理解其中的核心概念还是最重要的。

### 17.0.1. 事件流

在第四代Web 浏览器（IE4 和Netscape Communicator 4）开始开发时，开发团队碰到了一个有意思的问题：页面哪个部分拥有特定的事件呢？要理解这个问题，可以在一张纸上画几个同心圆。把手指放到圆心上，则手指不仅是在一个圆圈里，而且是在所有的圆圈里。两家浏览器的开发团队都是以同样的方式看待浏览器事件的。当你点击一个按钮时，实际上不光点击了这个按钮，还点击了它的容器以及整个页面。

事件流描述了页面接收事件的顺序。结果非常有意思，IE 和Netscape 开发团队提出了几乎完全相反的事件流方案。IE 将支持事件冒泡流，而Netscape Communicator 将支持事件捕获流。

### 17.0.2. 事件冒泡

IE 事件流被称为 **事件冒泡**，这是因为事件被定义为从最具体的元素（文档树中最深的节点）开始触发，然后向上传播至没有那么具体的元素（文档）。比如有如下HTML 页面：

```html
<!DOCTYPE html>
<html>
<head>
<title>Event Bubbling Example</title>
</head>
<body>
<div id="myDiv">Click Me</div>
</body>
</html>
```

在点击页面中的`<div>`元素后，click 事件会以如下顺序发生：

(1) `<div>`
(2) `<body>`
(3) `<html>`
(4) document

也就是说，`<div>`元素，即被点击的元素，最先触发click 事件。然后，click 事件沿DOM 树一路向上，在经过的每个节点上依次触发，直至到达document 对象。下图形象地展示了这个过程。

![17-1-事件冒泡](illustrations/17-1-事件冒泡.png)

所有现代浏览器都支持事件冒泡，只是在实现方式上会有一些变化。IE5.5 及早期版本会跳过`<html>`元素（从`<body>`直接到document）。现代浏览器中的事件会一直冒泡到window 对象。

### 17.0.3. 事件捕获

Netscape Communicator 团队提出了另一种名为 **事件捕获** 的事件流。事件捕获的意思是最不具体的节点应该最先收到事件，而最具体的节点应该最后收到事件。事件捕获实际上是为了在事件到达最终目标前拦截事件。如果前面的例子使用事件捕获，则点击`<div>`元素会以下列顺序触发click 事件：

(1) document
(2) `<html>`
(3) `<body>`
(4) `<div>`

在事件捕获中，click 事件首先由document 元素捕获，然后沿DOM树依次向下传播，直至到达实际的目标元素`<div>`。这个过程如下图所示。

![17-2-事件捕获](illustrations/17-2-事件捕获.png)

虽然这是Netscape Communicator 唯一的事件流模型，但事件捕获得到了所有现代浏览器的支持。实际上，所有浏览器都是从window 对象开始捕获事件，而DOM2 Events 规范规定的是从document 开始。

